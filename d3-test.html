<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Letsee AR Demo - Ultima Cena</title>
	<meta content="minimum-scale=1.0, width=device-width, maximum-scale=1, user-scalable=no, viewport-fit=cover" name="viewport" />
	<script src="./Letsee.0.9.14.js"></script>
	<link href="https://fonts.googleapis.com/css?family=Noto+Sans:100,300,400,700,900&display=swap" rel="stylesheet">
	<script src="//code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
	<script src="//code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>

	<script src="./vendor/jquery.scrollbar.min.js"></script>
	<link rel="stylesheet" href="./vendor/jquery.scrollbar.css">

	<script src="./vendor/hammer.min.js"></script>
	<script src="./vendor/axios.min.js"></script>

	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/comments.css">
	<link rel="stylesheet" href="css/response.css">

	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.js"></script>

	<style media="place" type="text/css">
		#container {
			-letsee-target: uri('ultima-cena.json');
			-letsee-position: coords(0, 0, 0);
			/*border: 1px solid #f00;*/
			width: 1000px;
			height: 560px;
		}

		#d3 {
			-letsee-target: uri('ultima-cena.json');
			-letsee-position: coords(0, 0, 0);
			/*border: 1px solid #f00;*/
			width: 1000px;
			height: 560px;
			border: 1px solid black;
		}

		#d3-node {
			width: 100px;
			height: 100px;
			border: 1px solid pink
		}

		.link {
			stroke: #000;
			stroke-width: 1.5px;
		}

		.group {
			border: 3px solid green;
		}

		.rect {
			border: 3px solid red;
		}

		/*.node {*/
		/*	width: 100px;*/
		/*	height: 100px;*/
		/*	cursor: move;*/
		/*	fill: #ccc;*/
		/*	stroke: #000;*/
		/*	stroke-width: 1.5px;*/
		/*}*/

		.node.fixed {
			fill: #f00;
		}

		.cardName {
			border: 10px solid red
		}
	</style>

	<style>

	</style>
</head>
<body>
<div id="container" style="display: block;"></div>
<div id="d3"></div>
<!-- END COMMENTS.HTML PAGE-->

<script type="text/javascript">
	/**
	 * Letsee Initialize function.
	 */
	function InitLetsee() {
		let CURRENT_URI = null;
		let currentTarget = null;
		const world = new Object3D();

		const initWorld = (e) =>  {
			let uri = e.target.uri;

			if (CURRENT_URI == null) {
				CURRENT_URI = uri;
				currentTarget = app.engine.getEntity(CURRENT_URI);
				e.target.addRenderable(world);
			}

			if (uri !== CURRENT_URI) {
				app.engine.getEntity(CURRENT_URI).removeRenderable(world);
				CURRENT_URI = uri;
				currentTarget = app.engine.getEntity(CURRENT_URI);
				e.target.addRenderable(world);
			}
		};

		const config = {
			"appKey": "8hTenCFZL3q3jIBZLHoQ72QYTvJdKM5IROK5hdUS69JeH91iGfWD7ApQWZSwzN2g",
			"trackerType": "PLANAR",
			"isSteady": true
		};
		const app = new Letsee(config);
		if(app !== null && typeof app !== 'undefined') {
			app.addEventListener('trackstart', e => {
				initWorld(e);
				initD3()
			});

		}
	}

	/**
	 * When the document is loaded, letsee is initialized.
	 */
	$(document).ready(() => {
		InitLetsee();
	});

	const initD3 = () => {
		const data = {
			"nodes": [
				{"x": 100, "y": 80, "text": "바르톨로메오", "name": "바르톨로메오"},
				{"x": 200, "y": 500, "text": "예수", "name": "안드레"},
				{"x": 300, "y": 800, "text": "예수", "name": "베드로"},
				// {"x": 20, "y": 500, "text": "예수", "name": "요한"},
				// {"x": 30, "y": 800, "text": "예수", "name": "토마스"},
				// {"x": 30, "y": 500, "text": "예수", "name": "필립보"},
				// {"x": 40, "y": 800, "text": "예수", "name": "마테오"},
				// {"x": 40, "y": 500, "text": "예수", "name": "성 시몬"},
				// {"x": 50, "y": 800, "text": "예수", "name": "큰 야보고"},
				// {"x": 50, "y": 500, "text": "예수", "name": "유다"},
				// {"x": 60, "y": 800, "text": "예수", "name": "예수"},
				// {"x": 60, "y": 500, "text": "예수", "name": "작은 야보고"},
				// {"x": 63, "y": 200, "text": "예수", "name": "유대"},

				{"x": 400, "y": 200, "text": "바르톨로메오-원점", "name": "바르톨로메오-원점"},
				{"x": 500, "y": 500, "text": "예수", "name": "안드레-원점"},
				{"x": 600, "y": 800, "text": "예수", "name": "베드로-원점"},
				// {"x": 20, "y": 500, "text": "예수", "name": "요한-원점"},
				// {"x": 30, "y": 800, "text": "예수", "name": "토마스-원점"},
				// {"x": 30, "y": 500, "text": "예수", "name": "필립보-원점"},
				// {"x": 40, "y": 800, "text": "예수", "name": "마테오-원점"},
				// {"x": 40, "y": 500, "text": "예수", "name": "성 시몬-원점"},
				// {"x": 50, "y": 800, "text": "예수", "name": "큰 야보고-원점"},
				// {"x": 50, "y": 500, "text": "예수", "name": "유다-원점"},
				// {"x": 60, "y": 800, "text": "예수", "name": "예수-원점"},
				// {"x": 60, "y": 500, "text": "예수", "name": "작은 야보고-원점"},
				// {"x": 63, "y": 200, "text": "예수", "name": "유대-원점"}
			],
			"links": [
				{"source":  "바르톨로메오", "target":  "바르톨로메오-원점"},
			]
		};

		// {"source":  2, "target":  3},
		// {"source":  4, "target":  5},
		// {"source":  6, "target":  7},
		// {"source":  8, "target":  9}

		data.nodes.forEach(function(d, i) {
			d.group = i;
		});

		data.nodes.forEach(function(d) {
			data.links.forEach(function(e) {
				if (e.source === d.name || e.target === d.name) {
					data.nodes.find(function(f) {
						return f.name === e.source
					}).links = d.links;
					data.nodes.find(function(f) {
						return f.name === e.target
					}).links = d.links;
				}
			})
		});

		// init d3 canvas
		let width = 1000;
		let height = 560;
		// let force = d3.layout.force()
		// 		.size([width, height])
		// 		.charge(-400)
		// 		.linkDistance(40)
		// 		.on("tick", tick);

		// d3.js를 그리는 영역을 지정한다.
		let svg = d3.select("#d3").append("svg")
				.attr("width", width)
				.attr("height", height);


		let link = svg.selectAll(".link");
		// let node = svg.selectAll(".node");
		let node = svg.selectAll(".g");

		// 데이터 설정
		link = link.data(data.links)
				.enter()
				.append("line")
		 		.attr("class", "link");

		node = node.data(data.nodes)
				.enter()
				// .attr("transform", (data) => {
				// 	return `translate(${data.x} ${data.y})`
				// })
				.append('svg:rect')
				.attr("class", "rect")
				.attr("width", 20)
				.attr("height", 20)
				// .attr("x", (d) => {
				// 	return d.x
				// })
				.attr("style" ,"fill:blue;stroke:pink;stroke-width:5;fill-opacity:0.1;stroke-opacity:0.9")
				// .attr("y", (d) => {
				// 	return d.y
				// })
				// .on("dblclick", dblclick)
				.append("svg:text")
				.text((data) => {
					return data.text
				});
				// .call(drag);


		var force = d3.layout
						.force()
						.size([width, height])
						.charge(-400)
						.linkDistance(40)
						.on("tick", () => {
							link
								.attr("x1", function(d) {
									const source  = data.nodes.find((item) => {
										return item.name === d.source
									});
									return source.x;
								})
								.attr("y1", function(d) {
									const source  = data.nodes.find((item) => {
										return item.name === d.source
									});
									return source.y;
								})
								.attr("x2", function(d) {
									const target  = data.nodes.find((item) => {
										return item.name === d.target
									});
									return target.x;
								})
								.attr("y2", function(d) {
									const target  = data.nodes.find((item) => {
										return item.name === d.target
									});
									return target.y;
								});

							node
								.attr("cx",(d) => {
									return d.x
								} )
								.attr("cy", function(d) {
									return d.y;
								});
						});




		force.nodes(data.nodes).links(data.links).start();


		let drag = force.drag().on("dragstart", dragstart);



		function tick() {
			link.attr("x1", function(d) { return d.source.x; })
					.attr("y1", function(d) { return d.source.y; })
					.attr("x2", function(d) { return d.target.x; })
					.attr("y2", function(d) { return d.target.y; });

			node.attr("cx", function(d) { return d.x; })
					.attr("cy", function(d) { return d.y; });
		}

		function dblclick(d) {
			d3.select(this).classed("fixed", d.fixed = false);
		}

		function dragstart(d) {
			d3.select(this).classed("fixed", d.fixed = true);
		}
	}
</script>

<!--<script type="text/javascript" src="js/hammer.js"></script>-->
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/screenfull.js/4.2.0/screenfull.min.js"></script>-->
<!--<script>let fs=!1;document.documentElement.addEventListener("click",()=>{screenfull.enabled&&!fs&&(screenfull.request(),fs=!0)});</script>-->
</body>
</html>
